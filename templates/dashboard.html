{% extends "base.html" %}
{% block content %}

<h2>ğŸ“Š Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ Ø§Ù…Ù†ÛŒØª</h2>
<form method="POST">
    <label>Ø§Ø² ØªØ§Ø±ÛŒØ®:</label>
    <input type="date" name="start_date" value="{{ start_date }}">
    <label>ØªØ§ ØªØ§Ø±ÛŒØ®:</label>
    <input type="date" name="end_date" value="{{ end_date }}">
    <button type="submit">ÙÛŒÙ„ØªØ±</button>
</form>

<ul>
    <li><strong>Ù…Ø¬Ù…ÙˆØ¹ Ú©Ù„ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§:</strong> {{ total_alerts }}</li>
    <li><strong>Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Ø§Ù…Ø±ÙˆØ²:</strong> {{ alerts_today }}</li>
    <li><strong>Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§ÛŒ Û· Ø±ÙˆØ² Ø§Ø®ÛŒØ±:</strong> {{ recent_alerts }}</li>
</ul>

<h3>ğŸ“Œ Ù†Ù…ÙˆØ¯Ø§Ø± Ù†ÙˆØ¹ Ù‡Ø´Ø¯Ø§Ø±Ù‡Ø§</h3>
<canvas id="typeChart" width="400" height="200"></canvas>

<h3>ğŸŒ Ø¨ÛŒØ´ØªØ±ÛŒÙ† IP Ù‡Ø§ÛŒ Ù…Ø´Ú©ÙˆÚ©</h3>
<table border="1" style="background:white; color:black;">
    <tr><th>IP</th><th>ØªØ¹Ø¯Ø§Ø¯ Ù‡Ø´Ø¯Ø§Ø±</th></tr>
    {% for ip, count in top_src_ips %}
        <tr><td>{{ ip }}</td><td>{{ count }}</td></tr>
    {% endfor %}
</table>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    const ctx = document.getElementById('typeChart').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'pie',
        data: {
            labels: {{ alerts_by_type | map(attribute=0) | list | safe }},
            datasets: [{
                label: 'Ù†ÙˆØ¹ Ù‡Ø´Ø¯Ø§Ø±',
                data: {{ alerts_by_type | map(attribute=1) | list | safe }},
                backgroundColor: ['#ff6384','#36a2eb','#ffce56','#8bc34a','#9c27b0']
            }]
        }
    });
</script>

{% endblock %}
